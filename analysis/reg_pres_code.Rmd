---
title: "Data Cleaning & EDA"
author: "Ethan Feldman, Michael Lewis"
date: "2022-12-01"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Libraries

```{r, include=FALSE}
library(tidyverse)
library(MASS)
library(car)
```

# Reading In the Raw Data

```{r}
income_df <- read_csv("../data/data-clean.csv")
head(income_df)
nrow(income_df)
colnames(income_df)

mutate(income_df, race = as_factor(race)) -> income_df
```

# EDA on raw data

## Graphs

```{r}
ggplot(data = income_df, mapping = aes(x = hours.week))+
  geom_histogram()

ggplot(data = income_df, mapping = aes(x = sex))+
  geom_bar()

ggplot(data = income_df, mapping = aes(x = education))+
  geom_bar()+
  coord_flip()

ggplot(data = income_df, mapping = aes(x = total.person.earnings))+
  geom_histogram()

ggplot(data = income_df, mapping = aes(x = full_time_labor_force))+
  geom_bar()

ggplot(data = income_df, mapping = aes(x = health.status))+
  geom_bar()

ggplot(data = income_df, mapping = aes(x = race))+
  geom_bar()+
  coord_flip()

ggplot(data = income_df, mapping = aes(x = industry))+
  geom_bar()+
  coord_flip()
```

# Numerical Summaries

```{r}

```

# Data Cleaning & Transformations

## Logging earnings

Because the response data (earnings) is skewed, we log the data to make it more normal.

```{r}
income_df %>% 
  mutate(earningslog = log(total.person.earnings)) %>%
  filter(earningslog != "-Inf") %>% #removing undefined results
  filter(earningslog != "Inf") %>% #removing undefined results
  filter(!is.nan(earningslog)) -> income_df_logged #removing anything else 

ggplot(data = income_df_logged, mapping = aes(x = earningslog))+
  geom_histogram(bins = 25) #data looks more normal / unimodal 

```

## Filtering down to the IQR

Our project is aimed at understanding the average American's income. As a result, we filtered our dataset down to the middle 50% of individuals.

```{r}
summary(income_df_logged$total.person.earnings)

#lower threshold 32000
#upper threshold 83000

income_df_logged$education  <- as_factor(income_df_logged$education)

levels(income_df_logged$education)

income_df_logged$education <- fct_collapse(income_df_logged$education,
          less_than_hs = c("Less than 1st grade", "5th or 6th grade",
                              "9th grade","1st,2nd,3rd,or 4th grade",
                              "12th grade no diploma", "10th grade",
                              "11th grade", "7th and 8th grade"),
          hs_grad = "High school graduate - high school diploma or equivalent", 
             col_nd = "Some college but no degree",
          associates = c("Associate degree in college - occupation/vocation program",
          "Associate degree in college - academic program"),
          bsba = "Bachelors degree",
          advanced = c("Masters degree", "Professional school degree",
                       "Doctorate degree"))

levels(income_df_logged$education)

income_df_logged %>% 
  filter(total.person.earnings > 32000) %>%
  filter(total.person.earnings < 83000) -> income_IQR
head(income_IQR)
```

## Model 1: Log Earnings = 𝛃0 + 𝛃1\*Race

```{r}
lm(earningslog ~ race, data = income_IQR) -> model1
summary(model1)
anova(model1)
plot(model1)
  
```
